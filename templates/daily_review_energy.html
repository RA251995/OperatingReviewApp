{% extends 'base.html' %}
{% block content %}
<div class="header-flex">
  <a href="{{ url_for('sos.index') }}" class="btn" title="Home">Home</a>
  <h2 class="center-heading">Daily Operating Review - Energy</h2>
</div>

<form method="POST" class="review-form">
  <label>Date:
    <input type="date" name="date" value="{{ selected_date }}" required class="input-date">
  </label>
  <button type="submit" class="btn">Show Details</button>
</form>

<div class="tables-flex">
  <div class="table-block">
    <h3>11kV Feeders - Hourly Δ EM Import/Export</h3>
    <table border="1">
      <thead>
        <tr>
          <th>Feeder</th>
          <th>Max Δ EM Import</th>
          <th>Time of Max</th>
          <th>Min Δ EM Import</th>
          <th>Time of Min</th>
          <th>Max Δ EM Export</th>
          <th>Time of Max</th>
          <th>Min Δ EM Export</th>
          <th>Time of Min</th>
        </tr>
      </thead>
      <tbody>
        {% if ht_em_diff and ht_em_diff|length > 0 %}
          {% for row in ht_em_diff %}
          <tr>
            <td>{{ row.code }}</td>
            <td>{{ row.max_delta_emc_import if row.max_delta_emc_import is not none else 'N/A' }}</td>
            <td>{{ row.time_max_delta_emc_import if row.time_max_delta_emc_import else 'N/A' }}</td>
            <td>{{ row.min_delta_emc_import if row.min_delta_emc_import is not none else 'N/A' }}</td>
            <td>{{ row.time_min_delta_emc_import if row.time_min_delta_emc_import else 'N/A' }}</td>
            <td>{{ row.max_delta_emc_export if row.max_delta_emc_export is not none else 'N/A' }}</td>
            <td>{{ row.time_max_delta_emc_export if row.time_max_delta_emc_export else 'N/A' }}</td>
            <td>{{ row.min_delta_emc_export if row.min_delta_emc_export is not none else 'N/A' }}</td>
            <td>{{ row.time_min_delta_emc_export if row.time_min_delta_emc_export else 'N/A' }}</td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="9" style="text-align:center;">No data available</td>
          </tr>
        {% endif %}
      </tbody>
    </table>

    <h3 class="section-heading">EHT Feeders - Hourly Δ EM Import/Export</h3>
    <table border="1">
      <thead>
        <tr>
          <th>Feeder</th>
          <th>Max Δ EM Import</th>
          <th>Time of Max</th>
          <th>Min Δ EM Import</th>
          <th>Time of Min</th>
          <th>Max Δ EM Export</th>
          <th>Time of Max</th>
          <th>Min Δ EM Export</th>
          <th>Time of Min</th>
        </tr>
      </thead>
      <tbody>
        {% if eht_em_diff and eht_em_diff|length > 0 %}
          {% for row in eht_em_diff %}
          <tr>
            <td>{{ row.code }}</td>
            <td>{{ row.max_delta_emc_import if row.max_delta_emc_import is not none else 'N/A' }}</td>
            <td>{{ row.time_max_delta_emc_import if row.time_max_delta_emc_import else 'N/A' }}</td>
            <td>{{ row.min_delta_emc_import if row.min_delta_emc_import is not none else 'N/A' }}</td>
            <td>{{ row.time_min_delta_emc_import if row.time_min_delta_emc_import else 'N/A' }}</td>
            <td>{{ row.max_delta_emc_export if row.max_delta_emc_export is not none else 'N/A' }}</td>
            <td>{{ row.time_max_delta_emc_export if row.time_max_delta_emc_export else 'N/A' }}</td>
            <td>{{ row.min_delta_emc_export if row.min_delta_emc_export is not none else 'N/A' }}</td>
            <td>{{ row.time_min_delta_emc_export if row.time_min_delta_emc_export else 'N/A' }}</td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="9" style="text-align:center;">No data available</td>
          </tr>
        {% endif %}
      </tbody>
    </table>

    <h3 class="section-heading">Transformers - Hourly Δ EM Import/Export</h3>
    <table border="1">
      <thead>
        <tr>
          <th>Transformer</th>
          <th>Max Δ EM Import</th>
          <th>Time of Max</th>
          <th>Min Δ EM Import</th>
          <th>Time of Min</th>
          <th>Max Δ EM Export</th>
          <th>Time of Max</th>
          <th>Min Δ EM Export</th>
          <th>Time of Min</th>
        </tr>
      </thead>
      <tbody>
        {% if tf_em_diff and tf_em_diff|length > 0 %}
          {% for row in tf_em_diff %}
          <tr>
            <td>{{ row.code }}</td>
            <td>{{ row.max_delta_emc_import if row.max_delta_emc_import is not none else 'N/A' }}</td>
            <td>{{ row.time_max_delta_emc_import if row.time_max_delta_emc_import else 'N/A' }}</td>
            <td>{{ row.min_delta_emc_import if row.min_delta_emc_import is not none else 'N/A' }}</td>
            <td>{{ row.time_min_delta_emc_import if row.time_min_delta_emc_import else 'N/A' }}</td>
            <td>{{ row.max_delta_emc_export if row.max_delta_emc_export is not none else 'N/A' }}</td>
            <td>{{ row.time_max_delta_emc_export if row.time_max_delta_emc_export else 'N/A' }}</td>
            <td>{{ row.min_delta_emc_export if row.min_delta_emc_export is not none else 'N/A' }}</td>
            <td>{{ row.time_min_delta_emc_export if row.time_min_delta_emc_export else 'N/A' }}</td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="9" style="text-align:center;">No data available</td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}